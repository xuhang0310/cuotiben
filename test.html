<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>错题本功能测试</title>
    
    <!-- 新的模块化样式 -->
    <link rel="stylesheet" href="styles/main.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }
        
        .test-error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #cf1322;
        }
        
        .test-info {
            background: #f0f9ff;
            border: 1px solid #91d5ff;
            color: #0958d9;
        }
        
        .test-button {
            margin: 5px;
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .test-button:hover {
            border-color: #1677ff;
            color: #1677ff;
        }
        
        .test-button.primary {
            background: #1677ff;
            border-color: #1677ff;
            color: #fff;
        }
        
        .test-button.primary:hover {
            background: #4096ff;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>错题本功能测试页面</h1>
        
        <!-- 样式测试 -->
        <div class="test-section">
            <div class="test-title">1. 样式系统测试</div>
            <div id="style-test-results"></div>
            <button class="test-button primary" onclick="testStyles()">测试样式加载</button>
        </div>
        
        <!-- JavaScript模块测试 -->
        <div class="test-section">
            <div class="test-title">2. JavaScript模块测试</div>
            <div id="js-test-results"></div>
            <button class="test-button primary" onclick="testJavaScript()">测试JS模块</button>
        </div>
        
        <!-- 组件测试 -->
        <div class="test-section">
            <div class="test-title">3. UI组件测试</div>
            <div id="component-test-results"></div>
            <button class="test-button" onclick="testNotification()">测试通知</button>
            <button class="test-button" onclick="testModal()">测试模态框</button>
            <button class="test-button" onclick="testConfirm()">测试确认对话框</button>
            <button class="test-button" onclick="testLoading()">测试加载状态</button>
        </div>
        
        <!-- 数据管理测试 -->
        <div class="test-section">
            <div class="test-title">4. 数据管理测试</div>
            <div id="data-test-results"></div>
            <button class="test-button" onclick="testDataStorage()">测试数据存储</button>
            <button class="test-button" onclick="testQuestionManager()">测试错题管理</button>
        </div>
        
        <!-- 路由测试 -->
        <div class="test-section">
            <div class="test-title">5. 路由系统测试</div>
            <div id="router-test-results"></div>
            <button class="test-button" onclick="testRouter()">测试路由</button>
        </div>
        
        <!-- 表单组件测试 -->
        <div class="test-section">
            <div class="test-title">6. 表单组件测试</div>
            <div id="form-test-results"></div>
            <div id="form-test-container" style="margin-top: 15px;"></div>
            <button class="test-button" onclick="testAddQuestionForm()">测试添加错题表单</button>
            <button class="test-button" onclick="testSearchForm()">测试搜索表单</button>
        </div>
        
        <!-- 页面组件测试 -->
        <div class="test-section">
            <div class="test-title">7. 页面组件测试</div>
            <div id="page-test-results"></div>
            <div id="page-test-container" style="margin-top: 15px; min-height: 200px; border: 1px dashed #d9d9d9; padding: 15px;"></div>
            <button class="test-button" onclick="testQuestionsPage()">测试错题列表页</button>
            <button class="test-button" onclick="testDashboardPage()">测试数据看板页</button>
            <button class="test-button" onclick="testAIPage()">测试AI讲解页</button>
        </div>
    </div>
    
    <!-- 引入所有模块 -->
    <script src="scripts/utils/helpers.js"></script>
    <script src="scripts/data/storage.js"></script>
    <script src="scripts/components/ui.js"></script>
    <script src="scripts/components/forms.js"></script>
    <script src="scripts/components/pages.js"></script>
    <script src="scripts/core/router.js"></script>
    <script src="scripts/core/app.js"></script>
    
    <script>
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result test-${type}`;
            div.textContent = message;
            container.appendChild(div);
        }
        
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }
        
        // 1. 测试样式系统
        function testStyles() {
            clearResults('style-test-results');
            
            try {
                // 检查CSS变量
                const root = getComputedStyle(document.documentElement);
                const primaryColor = root.getPropertyValue('--color-primary');
                
                if (primaryColor) {
                    logResult('style-test-results', '✓ CSS变量加载成功', 'success');
                } else {
                    logResult('style-test-results', '✗ CSS变量未找到', 'error');
                }
                
                // 检查样式类
                const testElement = document.createElement('div');
                testElement.className = 'btn btn-primary';
                document.body.appendChild(testElement);
                
                const styles = getComputedStyle(testElement);
                if (styles.backgroundColor) {
                    logResult('style-test-results', '✓ 按钮样式加载成功', 'success');
                } else {
                    logResult('style-test-results', '✗ 按钮样式未加载', 'error');
                }
                
                document.body.removeChild(testElement);
                
            } catch (error) {
                logResult('style-test-results', `✗ 样式测试失败: ${error.message}`, 'error');
            }
        }
        
        // 2. 测试JavaScript模块
        function testJavaScript() {
            clearResults('js-test-results');
            
            const modules = [
                { name: 'helpers', obj: window.helpers },
                { name: 'dataStorage', obj: window.dataStorage },
                { name: 'questionManager', obj: window.questionManager },
                { name: 'UI', obj: window.UI },
                { name: 'Forms', obj: window.Forms },
                { name: 'Pages', obj: window.Pages },
                { name: 'router', obj: window.router },
                { name: 'app', obj: window.app }
            ];
            
            modules.forEach(module => {
                if (module.obj) {
                    logResult('js-test-results', `✓ ${module.name} 模块加载成功`, 'success');
                } else {
                    logResult('js-test-results', `✗ ${module.name} 模块未加载`, 'error');
                }
            });
        }
        
        // 3. 测试UI组件
        function testNotification() {
            clearResults('component-test-results');
            try {
                window.UI.notification.success('这是一个成功通知');
                logResult('component-test-results', '✓ 通知组件测试成功', 'success');
            } catch (error) {
                logResult('component-test-results', `✗ 通知组件测试失败: ${error.message}`, 'error');
            }
        }
        
        function testModal() {
            try {
                const modal = new window.UI.Modal({
                    title: '测试模态框',
                    content: '<p>这是一个测试模态框</p>',
                    width: 400
                });
                modal.show();
                logResult('component-test-results', '✓ 模态框组件测试成功', 'success');
            } catch (error) {
                logResult('component-test-results', `✗ 模态框组件测试失败: ${error.message}`, 'error');
            }
        }
        
        function testConfirm() {
            try {
                window.UI.ConfirmDialog.show({
                    title: '测试确认对话框',
                    message: '这是一个测试确认对话框',
                    type: 'info'
                }).then(result => {
                    logResult('component-test-results', `✓ 确认对话框测试成功，结果: ${result}`, 'success');
                });
            } catch (error) {
                logResult('component-test-results', `✗ 确认对话框测试失败: ${error.message}`, 'error');
            }
        }
        
        function testLoading() {
            try {
                window.UI.loading.show('测试加载中...');
                setTimeout(() => {
                    window.UI.loading.hide();
                    logResult('component-test-results', '✓ 加载组件测试成功', 'success');
                }, 2000);
            } catch (error) {
                logResult('component-test-results', `✗ 加载组件测试失败: ${error.message}`, 'error');
            }
        }
        
        // 4. 测试数据管理
        function testDataStorage() {
            clearResults('data-test-results');
            try {
                // 测试数据存储
                const testData = { test: 'value', timestamp: Date.now() };
                window.dataStorage.setItem('test_key', testData);
                const retrieved = window.dataStorage.getItem('test_key');
                
                if (retrieved && retrieved.test === 'value') {
                    logResult('data-test-results', '✓ 数据存储测试成功', 'success');
                } else {
                    logResult('data-test-results', '✗ 数据存储测试失败', 'error');
                }
                
                // 清理测试数据
                window.dataStorage.removeItem('test_key');
                
            } catch (error) {
                logResult('data-test-results', `✗ 数据存储测试失败: ${error.message}`, 'error');
            }
        }
        
        function testQuestionManager() {
            try {
                // 测试添加错题
                const testQuestion = {
                    id: 'test_' + Date.now(),
                    subject: 'math',
                    difficulty: 'medium',
                    content: '测试题目内容',
                    answer: '测试答案',
                    explanation: '测试解析'
                };
                
                window.questionManager.addQuestion(testQuestion);
                const questions = window.questionManager.getQuestions();
                
                if (questions.data.some(q => q.id === testQuestion.id)) {
                    logResult('data-test-results', '✓ 错题管理测试成功', 'success');
                    // 清理测试数据
                    window.questionManager.deleteQuestion(testQuestion.id);
                } else {
                    logResult('data-test-results', '✗ 错题管理测试失败', 'error');
                }
                
            } catch (error) {
                logResult('data-test-results', `✗ 错题管理测试失败: ${error.message}`, 'error');
            }
        }
        
        // 5. 测试路由系统
        function testRouter() {
            clearResults('router-test-results');
            try {
                if (window.router && typeof window.router.navigate === 'function') {
                    logResult('router-test-results', '✓ 路由系统加载成功', 'success');
                    
                    // 测试路由注册
                    const routes = window.router.routes;
                    if (routes && Object.keys(routes).length > 0) {
                        logResult('router-test-results', `✓ 已注册 ${Object.keys(routes).length} 个路由`, 'success');
                    } else {
                        logResult('router-test-results', '✗ 未找到注册的路由', 'error');
                    }
                } else {
                    logResult('router-test-results', '✗ 路由系统未正确加载', 'error');
                }
            } catch (error) {
                logResult('router-test-results', `✗ 路由系统测试失败: ${error.message}`, 'error');
            }
        }
        
        // 6. 测试表单组件
        function testAddQuestionForm() {
            clearResults('form-test-results');
            const container = document.getElementById('form-test-container');
            container.innerHTML = '';
            
            try {
                const form = new window.Forms.AddQuestionForm(container, {
                    onSubmit: (data) => {
                        logResult('form-test-results', '✓ 表单提交测试成功', 'success');
                        console.log('表单数据:', data);
                    },
                    onCancel: () => {
                        container.innerHTML = '';
                        logResult('form-test-results', '✓ 表单取消测试成功', 'success');
                    }
                });
                
                form.render();
                logResult('form-test-results', '✓ 添加错题表单渲染成功', 'success');
                
            } catch (error) {
                logResult('form-test-results', `✗ 添加错题表单测试失败: ${error.message}`, 'error');
            }
        }
        
        function testSearchForm() {
            const container = document.getElementById('form-test-container');
            container.innerHTML = '';
            
            try {
                const searchForm = new window.Forms.SearchForm(container, {
                    onSearch: (data) => {
                        logResult('form-test-results', `✓ 搜索表单测试成功: ${JSON.stringify(data)}`, 'success');
                    },
                    placeholder: '测试搜索...'
                });
                
                searchForm.render();
                logResult('form-test-results', '✓ 搜索表单渲染成功', 'success');
                
            } catch (error) {
                logResult('form-test-results', `✗ 搜索表单测试失败: ${error.message}`, 'error');
            }
        }
        
        // 7. 测试页面组件
        function testQuestionsPage() {
            clearResults('page-test-results');
            const container = document.getElementById('page-test-container');
            container.innerHTML = '';
            
            try {
                const page = new window.Pages.QuestionsPage();
                container.innerHTML = page.render();
                page.init();
                logResult('page-test-results', '✓ 错题列表页面测试成功', 'success');
            } catch (error) {
                logResult('page-test-results', `✗ 错题列表页面测试失败: ${error.message}`, 'error');
            }
        }
        
        function testDashboardPage() {
            const container = document.getElementById('page-test-container');
            container.innerHTML = '';
            
            try {
                const page = new window.Pages.DashboardPage();
                container.innerHTML = page.render();
                page.init();
                logResult('page-test-results', '✓ 数据看板页面测试成功', 'success');
            } catch (error) {
                logResult('page-test-results', `✗ 数据看板页面测试失败: ${error.message}`, 'error');
            }
        }
        
        function testAIPage() {
            const container = document.getElementById('page-test-container');
            container.innerHTML = '';
            
            try {
                const page = new window.Pages.AIExplanationPage();
                container.innerHTML = page.render();
                page.init();
                logResult('page-test-results', '✓ AI讲解页面测试成功', 'success');
            } catch (error) {
                logResult('page-test-results', `✗ AI讲解页面测试失败: ${error.message}`, 'error');
            }
        }
        
        // 页面加载完成后自动运行基础测试
        window.addEventListener('load', () => {
            setTimeout(() => {
                testStyles();
                testJavaScript();
            }, 500);
        });
    </script>
</body>
</html>