<!-- 数据看板页面 -->
<div id="dashboard" class="ant-page">
    <div class="page-header">
        <h2 class="page-title">学习数据看板</h2>
        <div class="page-actions">
            <button class="ant-btn ant-btn-default" id="exportReport">
                <i class="fas fa-download"></i>
                导出报告
            </button>
            <button class="ant-btn ant-btn-primary" id="refreshData">
                <i class="fas fa-sync-alt"></i>
                刷新数据
            </button>
        </div>
    </div>
    
    <div class="overview-cards">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-book" style="color: var(--ant-primary);"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="totalQuestions">247</div>
                <div class="stat-label">总错题数</div>
                <div class="stat-trend up">
                    <i class="fas fa-arrow-up"></i>
                    12.5%
                </div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle" style="color: var(--ant-success);"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="masteredQuestions">189</div>
                <div class="stat-label">已掌握</div>
                <div class="stat-trend up">
                    <i class="fas fa-arrow-up"></i>
                    8.3%
                </div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock" style="color: var(--ant-warning);"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="pendingQuestions">58</div>
                <div class="stat-label">待复习</div>
                <div class="stat-trend down">
                    <i class="fas fa-arrow-down"></i>
                    5.2%
                </div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-percentage" style="color: var(--ui-primary);"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="masteryRate">76.5%</div>
                <div class="stat-label">掌握率</div>
                <div class="stat-trend up">
                    <i class="fas fa-arrow-up"></i>
                    3.8%
                </div>
            </div>
        </div>
    </div>
    
    <div class="charts-grid">
        <div class="chart-card">
            <div class="chart-header">
                <h3>学科分布</h3>
                <div class="chart-actions">
                    <button class="chart-btn" data-period="week">周</button>
                    <button class="chart-btn active" data-period="month">月</button>
                    <button class="chart-btn" data-period="year">年</button>
                </div>
            </div>
            <div class="chart-content">
                <div class="chart-placeholder" id="subjectChart">
                    <!-- 学科分布图表 -->
                    <div class="chart-item">
                        <div class="chart-bar" style="height: 80%; background: var(--subject-math);"></div>
                        <div class="chart-label">数学</div>
                        <div class="chart-value">89</div>
                    </div>
                    <div class="chart-item">
                        <div class="chart-bar" style="height: 60%; background: var(--subject-chinese);"></div>
                        <div class="chart-label">语文</div>
                        <div class="chart-value">67</div>
                    </div>
                    <div class="chart-item">
                        <div class="chart-bar" style="height: 45%; background: var(--subject-english);"></div>
                        <div class="chart-label">英语</div>
                        <div class="chart-value">52</div>
                    </div>
                    <div class="chart-item">
                        <div class="chart-bar" style="height: 30%; background: var(--subject-physics);"></div>
                        <div class="chart-label">物理</div>
                        <div class="chart-value">39</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chart-card">
            <div class="chart-header">
                <h3>掌握度趋势</h3>
                <div class="chart-actions">
                    <button class="chart-btn" data-period="week">周</button>
                    <button class="chart-btn active" data-period="month">月</button>
                    <button class="chart-btn" data-period="year">年</button>
                </div>
            </div>
            <div class="chart-content">
                <div class="chart-placeholder" id="masteryTrendChart">
                    <!-- 掌握度趋势图表 -->
                    <div class="trend-line">
                        <svg width="100%" height="200" viewBox="0 0 400 200">
                            <polyline points="0,150 50,140 100,120 150,100 200,90 250,80 300,70 350,60 400,50" 
                                     fill="none" stroke="var(--ant-success)" stroke-width="3"/>
                            <circle cx="400" cy="50" r="4" fill="var(--ant-success)"/>
                        </svg>
                    </div>
                    <div class="trend-labels">
                        <span>1月</span>
                        <span>2月</span>
                        <span>3月</span>
                        <span>4月</span>
                        <span>5月</span>
                        <span>6月</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chart-card full-width">
            <div class="chart-header">
                <h3>学习活动热力图</h3>
                <div class="chart-actions">
                    <span class="heat-legend">
                        <span class="legend-item">
                            <span class="legend-color" style="background: #ebedf0;"></span>
                            少
                        </span>
                        <span class="legend-item">
                            <span class="legend-color" style="background: #9be9a8;"></span>
                        </span>
                        <span class="legend-item">
                            <span class="legend-color" style="background: #40c463;"></span>
                        </span>
                        <span class="legend-item">
                            <span class="legend-color" style="background: #30a14e;"></span>
                        </span>
                        <span class="legend-item">
                            <span class="legend-color" style="background: #216e39;"></span>
                            多
                        </span>
                    </span>
                </div>
            </div>
            <div class="chart-content">
                <div class="heatmap-container" id="activityHeatmap">
                    <!-- 热力图将通过JavaScript生成 -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="insights-section">
        <div class="insight-card">
            <div class="insight-icon">
                <i class="fas fa-lightbulb" style="color: var(--ant-warning);"></i>
            </div>
            <div class="insight-content">
                <h4>学习建议</h4>
                <p>数学错题较多，建议重点复习函数和几何部分。物理力学章节掌握度较低，需要加强练习。</p>
            </div>
        </div>
        
        <div class="insight-card">
            <div class="insight-icon">
                <i class="fas fa-target" style="color: var(--ant-success);"></i>
            </div>
            <div class="insight-content">
                <h4>复习计划</h4>
                <p>今日需复习 12 道错题，本周目标完成 85 道错题复习，当前进度良好。</p>
            </div>
        </div>
    </div>
</div>

<script>
// 页面初始化
document.addEventListener('DOMContentLoaded', function() {
    initDashboard();
});

function initDashboard() {
    // 绑定事件监听器
    bindDashboardEvents();
    
    // 加载数据
    loadDashboardData();
    
    // 生成热力图
    generateHeatmap();
}

function bindDashboardEvents() {
    // 导出报告
    const exportBtn = document.getElementById('exportReport');
    if (exportBtn) {
        exportBtn.addEventListener('click', exportReport);
    }
    
    // 刷新数据
    const refreshBtn = document.getElementById('refreshData');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', refreshDashboardData);
    }
    
    // 图表时间段切换
    const chartBtns = document.querySelectorAll('.chart-btn');
    chartBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const parent = this.closest('.chart-actions');
            parent.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const period = this.dataset.period;
            updateChartData(period);
        });
    });
}

function loadDashboardData() {
    // 从 DataManager 获取统计数据
    if (window.dataManager) {
        const stats = window.dataManager.getStatistics();
        updateStatCards(stats);
    }
}

function updateStatCards(stats) {
    // 更新统计卡片数据
    const elements = {
        totalQuestions: document.getElementById('totalQuestions'),
        masteredQuestions: document.getElementById('masteredQuestions'),
        pendingQuestions: document.getElementById('pendingQuestions'),
        masteryRate: document.getElementById('masteryRate')
    };
    
    if (stats && elements.totalQuestions) {
        elements.totalQuestions.textContent = stats.total || 247;
        elements.masteredQuestions.textContent = stats.mastered || 189;
        elements.pendingQuestions.textContent = stats.pending || 58;
        elements.masteryRate.textContent = `${stats.masteryRate || 76.5}%`;
    }
}

function generateHeatmap() {
    // 生成学习活动热力图
    const container = document.getElementById('activityHeatmap');
    if (!container) return;
    
    const weeks = 52;
    const days = 7;
    let html = '<div class="heatmap-grid">';
    
    for (let week = 0; week < weeks; week++) {
        html += '<div class="heatmap-week">';
        for (let day = 0; day < days; day++) {
            const intensity = Math.floor(Math.random() * 5);
            const colors = ['#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39'];
            html += `<div class="heatmap-day" style="background-color: ${colors[intensity]}" title="${intensity} 道错题"></div>`;
        }
        html += '</div>';
    }
    
    html += '</div>';
    container.innerHTML = html;
}

function updateChartData(period) {
    console.log('Updating chart data for period:', period);
    // 根据时间段更新图表数据
}

function exportReport() {
    console.log('Exporting learning report...');
    // 导出学习报告逻辑
}

function refreshDashboardData() {
    console.log('Refreshing dashboard data...');
    // 刷新数据逻辑
    loadDashboardData();
}
</script>