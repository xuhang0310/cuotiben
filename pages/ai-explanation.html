<!-- AI讲解中心页面 -->
<div id="ai-explanation" class="ant-page">
    <div class="page-header">
        <h2 class="page-title">AI错题讲解</h2>
        <div class="page-actions">
            <button class="ant-btn ant-btn-default" id="clearChat">
                <i class="fas fa-trash"></i>
                清空对话
            </button>
            <button class="ant-btn ant-btn-primary" id="voiceToggle">
                <i class="fas fa-microphone"></i>
                语音输入
            </button>
        </div>
    </div>
    
    <div class="ai-container">
        <div class="ai-chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div class="avatar ai-avatar">🤖</div>
                    <div class="message-content">
                        <p>你好！我是你的AI学习助手，可以帮你：</p>
                        <ul>
                            <li>📝 错题知识点分析</li>
                            <li>💡 解题思路指导</li>
                            <li>📚 相关知识点推荐</li>
                            <li>🎯 学习计划建议</li>
                        </ul>
                        <p>请选择一道错题或直接向我提问吧！</p>
                    </div>
                    <div class="message-time">刚刚</div>
                </div>
                
                <div class="message user-message">
                    <div class="avatar user-avatar">张</div>
                    <div class="message-content">
                        <p>这道函数题我不太明白，能帮我分析一下吗？</p>
                    </div>
                    <div class="message-time">2分钟前</div>
                </div>
                
                <div class="message ai-message">
                    <div class="avatar ai-avatar">🤖</div>
                    <div class="message-content">
                        <p>当然可以！这是一道复合函数求导题。让我为你详细分析：</p>
                        <div class="analysis-card">
                            <h4>🔍 题目分析</h4>
                            <p>这道题考查的是复合函数的求导法则（链式法则）</p>
                        </div>
                        <div class="analysis-card">
                            <h4>📋 解题步骤</h4>
                            <ol>
                                <li>识别内外层函数</li>
                                <li>分别求导外层和内层函数</li>
                                <li>应用链式法则相乘</li>
                                <li>化简得到最终结果</li>
                            </ol>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="playExplanation()">
                                <i class="fas fa-play"></i>
                                语音播放
                            </button>
                            <button class="action-btn" onclick="showSimilarQuestions()">
                                <i class="fas fa-search"></i>
                                相似题目
                            </button>
                        </div>
                    </div>
                    <div class="message-time">1分钟前</div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="quick-questions">
                    <button class="quick-btn" onclick="askQuickQuestion('解题思路')">
                        💡 解题思路
                    </button>
                    <button class="quick-btn" onclick="askQuickQuestion('知识点')">
                        📚 相关知识点
                    </button>
                    <button class="quick-btn" onclick="askQuickQuestion('易错点')">
                        ⚠️ 常见易错点
                    </button>
                    <button class="quick-btn" onclick="askQuickQuestion('练习题')">
                        📝 推荐练习
                    </button>
                </div>
                
                <div class="chat-input">
                    <input type="text" class="chat-input-field" id="chatInput" placeholder="输入你的问题...">
                    <button class="attachment-btn" id="attachmentBtn">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="ai-features">
            <div class="feature-card">
                <div class="feature-icon">🔊</div>
                <h3>语音讲解</h3>
                <p>支持语音播放，随时随地学习</p>
                <button class="feature-btn" onclick="toggleVoiceMode()">
                    启用语音
                </button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">📊</div>
                <h3>学习分析</h3>
                <p>分析学习薄弱点，推荐复习重点</p>
                <button class="feature-btn" onclick="showLearningAnalysis()">
                    查看分析
                </button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">📺</div>
                <h3>视频解析</h3>
                <p>观看名师视频讲解</p>
                <button class="feature-btn" onclick="openVideoLibrary()">
                    视频库
                </button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <h3>个性化推荐</h3>
                <p>基于学习情况推荐内容</p>
                <button class="feature-btn" onclick="getRecommendations()">
                    获取推荐
                </button>
            </div>
        </div>
    </div>
    
    <!-- 文件上传模态框 -->
    <div class="modal" id="uploadModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>上传题目图片</h3>
                <button class="modal-close" onclick="closeUploadModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>拖拽图片到此处或点击上传</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    <button class="ant-btn ant-btn-primary" onclick="document.getElementById('fileInput').click()">
                        选择文件
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 页面初始化
document.addEventListener('DOMContentLoaded', function() {
    initAIPage();
});

function initAIPage() {
    bindAIEvents();
    scrollToBottom();
}

function bindAIEvents() {
    // 发送消息
    const sendBtn = document.getElementById('sendBtn');
    const chatInput = document.getElementById('chatInput');
    
    if (sendBtn) {
        sendBtn.addEventListener('click', sendMessage);
    }
    
    if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    }
    
    // 附件上传
    const attachmentBtn = document.getElementById('attachmentBtn');
    if (attachmentBtn) {
        attachmentBtn.addEventListener('click', () => {
            document.getElementById('uploadModal').style.display = 'flex';
        });
    }
    
    // 清空对话
    const clearBtn = document.getElementById('clearChat');
    if (clearBtn) {
        clearBtn.addEventListener('click', clearChat);
    }
    
    // 语音切换
    const voiceToggle = document.getElementById('voiceToggle');
    if (voiceToggle) {
        voiceToggle.addEventListener('click', toggleVoiceInput);
    }
}

function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // 添加用户消息
    addMessage(message, 'user');
    
    // 清空输入框
    input.value = '';
    
    // 模拟AI回复
    setTimeout(() => {
        const aiResponse = generateAIResponse(message);
        addMessage(aiResponse, 'ai');
    }, 1000);
}

function addMessage(content, type) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
    
    const avatar = type === 'ai' ? '🤖' : '张';
    const time = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    
    messageDiv.innerHTML = `
        <div class="avatar ${type}-avatar">${avatar}</div>
        <div class="message-content">
            <p>${content}</p>
        </div>
        <div class="message-time">${time}</div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    scrollToBottom();
}

function generateAIResponse(userMessage) {
    // 简单的AI回复逻辑
    const responses = [
        '我理解你的问题。让我来帮你分析一下这道题的解题思路...',
        '这是一个很好的问题！这类题目的关键在于...',
        '根据你的描述，我建议你从以下几个方面来理解这道题...',
        '让我为你详细讲解这个知识点的应用方法...'
    ];
    
    return responses[Math.floor(Math.random() * responses.length)];
}

function scrollToBottom() {
    const messagesContainer = document.getElementById('chatMessages');
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function askQuickQuestion(type) {
    const questions = {
        '解题思路': '请帮我分析这道题的解题思路',
        '知识点': '这道题涉及哪些知识点？',
        '易错点': '这类题目有哪些常见的易错点？',
        '练习题': '能推荐一些类似的练习题吗？'
    };
    
    const question = questions[type];
    if (question) {
        document.getElementById('chatInput').value = question;
        sendMessage();
    }
}

function playExplanation() {
    console.log('Playing voice explanation...');
    // 语音播放逻辑
}

function showSimilarQuestions() {
    console.log('Showing similar questions...');
    // 显示相似题目
}

function clearChat() {
    const messagesContainer = document.getElementById('chatMessages');
    // 保留欢迎消息
    const welcomeMessage = messagesContainer.querySelector('.ai-message');
    messagesContainer.innerHTML = '';
    if (welcomeMessage) {
        messagesContainer.appendChild(welcomeMessage.cloneNode(true));
    }
}

function toggleVoiceInput() {
    console.log('Toggling voice input...');
    // 语音输入切换逻辑
}

function toggleVoiceMode() {
    console.log('Toggling voice mode...');
}

function showLearningAnalysis() {
    console.log('Showing learning analysis...');
}

function openVideoLibrary() {
    console.log('Opening video library...');
}

function getRecommendations() {
    console.log('Getting personalized recommendations...');
}

function closeUploadModal() {
    document.getElementById('uploadModal').style.display = 'none';
}
</script>